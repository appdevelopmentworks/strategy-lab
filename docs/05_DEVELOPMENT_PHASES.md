# StrategyLab 開発フェーズ計画

## 概要

本ドキュメントでは、StrategyLabの開発を8つのフェーズに分割し、各フェーズの目標、タスク、成果物を定義します。

---

## 開発フェーズ一覧

| フェーズ | 名称 | 優先度 | 概算期間 |
|----------|------|--------|----------|
| Phase 1 | プロジェクト基盤構築 | MVP | 2-3日 |
| Phase 2 | バックテストエンジン | MVP | 3-4日 |
| Phase 3 | 結果一覧・可視化 | MVP | 2-3日 |
| Phase 4 | チャート表示 | MVP | 3-4日 |
| Phase 5 | パラメーター調整 | MVP | 2-3日 |
| Phase 6 | 戦略サーチ・最適化 | 拡張 | 4-5日 |
| Phase 7 | エクスポート機能 | 拡張 | 3-4日 |
| Phase 8 | 複数銘柄比較・仕上げ | 拡張 | 2-3日 |

---

## Phase 1: プロジェクト基盤構築

### 目標
Next.js 16プロジェクトのセットアップと基本構造の確立

### タスク

- [ ] Next.js 16プロジェクト初期化
  - TypeScript設定
  - Tailwind CSS設定
  - App Router構成
  - Turbopack有効化

- [ ] 開発環境構築
  - Biome（Linter/Formatter）設定
  - Git初期化
  - .gitignore設定
  - 環境変数設定

- [ ] UIライブラリ導入
  - shadcn/ui初期化
  - 必要コンポーネント追加（Button, Input, Select, Tabs, Card, Table等）
  - ダークモード設定

- [ ] 基本レイアウト作成
  - ヘッダーコンポーネント
  - メインレイアウト
  - ナビゲーション（タブ）

- [ ] 型定義
  - 株価データ型
  - 戦略型
  - バックテスト結果型
  - パラメーター型

### 成果物
- 動作するNext.js 16プロジェクト
- 基本UIレイアウト
- 型定義ファイル

---

## Phase 2: バックテストエンジン

### 目標
株価データ取得とバックテスト計算ロジックの実装

### タスク

- [ ] データ取得API
  - Yahoo Finance APIラッパー作成
  - 日足データ取得エンドポイント
  - エラーハンドリング
  - キャッシュ機能（オプション）

- [ ] テクニカル指標計算
  - SMA/EMA
  - RSI
  - MACD
  - ボリンジャーバンド
  - その他必要な指標

- [ ] 戦略ロジック実装（Phase 1: 基本10戦略）
  - TF001: SMAクロスオーバー
  - TF002: EMAクロスオーバー
  - TF003: MACDシグナル
  - MO001: RSI順張り
  - MO002: RSI逆張り
  - MO003: ストキャスティクス
  - BO001: ボリンジャーバンド・ブレイクアウト
  - BO002: ドンチャンチャネル
  - MR001: ボリンジャーバンド逆張り
  - PA001: ゴールデンクロス

- [ ] バックテストエンジン
  - シグナル生成
  - トレード実行シミュレーション
  - 指標計算（勝率、リターン、PF等）

- [ ] APIエンドポイント
  - POST /api/backtest
  - GET /api/stock/:ticker

### 成果物
- 株価データ取得機能
- テクニカル指標ライブラリ
- 10戦略のバックテスト実行機能

---

## Phase 3: 結果一覧・可視化

### 目標
バックテスト結果の表示とソート・フィルタリング機能

### タスク

- [ ] 結果テーブルコンポーネント
  - ソート機能（勝率、リターン、PF、シャープ、DD）
  - ページネーション
  - レスポンシブ対応（モバイル用カード表示）

- [ ] フィルタリング機能
  - 勝率フィルター
  - トレード回数フィルター
  - リターンフィルター
  - 複合条件

- [ ] 棒グラフコンポーネント
  - Rechartsで横棒グラフ実装
  - ソート基準に応じた動的表示
  - ホバー時の詳細表示

- [ ] 入力セクション
  - ティッカー入力（オートコンプリート）
  - 期間選択
  - 分析実行ボタン
  - ローディング状態表示

### 成果物
- 結果一覧画面
- ソート・フィルター機能
- 棒グラフ可視化

---

## Phase 4: チャート表示

### 目標
価格チャートと売買ポイントの可視化

### タスク

- [ ] チャートコンポーネント
  - Recharts（ラインチャート）
  - lightweight-charts（ローソク足）
  - チャート種別切り替え

- [ ] 売買マーカー
  - 買いシグナル（▲緑）
  - 売りシグナル（▼赤）
  - マーカー配置ロジック

- [ ] ツールチップ
  - 日付、価格
  - シグナル種別
  - 戦略名
  - 指標値
  - 損益（決済時）

- [ ] インタラクション
  - ズーム/パン
  - 期間選択（1M/3M/6M/1Y/全期間）
  - 銘柄・戦略切り替え

- [ ] テクニカル指標オーバーレイ
  - 移動平均線
  - ボリンジャーバンド
  - その他（オプション）

### 成果物
- ローソク足/ラインチャート
- 売買ポイント表示
- インタラクティブ機能

---

## Phase 5: パラメーター調整

### 目標
戦略パラメーターの調整UIとリアルタイム反映

### タスク

- [ ] パラメーター入力コンポーネント
  - スライダー + 数値入力
  - パラメーター範囲制限
  - リアルタイムバリデーション

- [ ] 戦略別パラメーターフォーム
  - 各戦略のパラメーター定義
  - 動的フォーム生成
  - デフォルト値設定

- [ ] リアルタイムプレビュー
  - パラメーター変更時の即時再計算
  - 変化量の表示（+/-）
  - デバウンス処理

- [ ] LocalStorage保存
  - パラメーター保存
  - パラメーター読み込み
  - プリセット管理
  - エクスポート/インポート

- [ ] リセット機能
  - デフォルト値復元
  - 確認ダイアログ

### 成果物
- パラメーター調整UI
- LocalStorage永続化
- プリセット機能

---

## Phase 6: 戦略サーチ・最適化

### 目標
グリッドサーチによるパラメーター最適化と過学習防止

### タスク

- [ ] 残り30戦略の実装
  - トレンドフォロー系残り
  - モメンタム系残り
  - ブレイクアウト系残り
  - ミーンリバーサル系残り
  - ボリューム系
  - パターン認識系
  - 複合系

- [ ] グリッドサーチエンジン
  - パラメーター範囲設定
  - ステップ設定
  - 組み合わせ生成
  - 並列処理（Web Worker）

- [ ] 目標関数
  - 勝率最大化
  - リターン最大化
  - プロフィットファクター最大化
  - シャープレシオ最大化

- [ ] ウォークフォワード検証
  - データ分割（学習/検証）
  - アウトオブサンプルテスト
  - 過学習リスク評価

- [ ] 最適化UI
  - 範囲設定フォーム
  - 進捗表示
  - 結果表示
  - 最適パラメーター適用

### 成果物
- 全40戦略実装
- グリッドサーチ機能
- ウォークフォワード検証

---

## Phase 7: エクスポート機能

### 目標
シグナルデータとトレードコードの出力

### タスク

- [ ] シグナルデータ出力
  - CSV形式
  - JSON形式
  - フィールド選択

- [ ] MQLコード生成
  - MT4用テンプレート
  - MT5用テンプレート
  - パラメーター埋め込み

- [ ] PineScript生成
  - インジケーター形式
  - ストラテジー形式
  - パラメーター埋め込み

- [ ] パラメーター出力
  - JSON形式
  - インポート機能
  - バージョン管理

- [ ] エクスポート画面
  - 出力形式選択
  - プレビュー
  - ダウンロード

### 成果物
- CSV/JSONエクスポート
- MQL/PineScriptコード生成
- パラメーターエクスポート

---

## Phase 8: 複数銘柄比較・仕上げ

### 目標
複数銘柄の同時分析と最終調整

### タスク

- [ ] 複数銘柄入力
  - 最大5銘柄対応
  - 入力UI改善

- [ ] 比較表示
  - 銘柄別結果比較
  - ベスト戦略表示
  - チャートオーバーレイ/分割

- [ ] パフォーマンス最適化
  - バックテスト並列化
  - メモ化
  - 遅延読み込み

- [ ] テスト
  - ユニットテスト
  - 統合テスト
  - E2Eテスト

- [ ] ドキュメント
  - README作成
  - 使い方ガイド
  - APIドキュメント

- [ ] デプロイ準備
  - Vercel設定
  - 環境変数設定
  - ドメイン設定

### 成果物
- 複数銘柄比較機能
- テストスイート
- 本番デプロイ

---

## マイルストーン

| マイルストーン | フェーズ | 目標 |
|---------------|---------|------|
| MVP完成 | Phase 1-5 | 基本機能が動作する状態 |
| フル機能完成 | Phase 6-7 | 全機能実装完了 |
| リリース | Phase 8 | 本番環境デプロイ |

---

## 依存関係

```
Phase 1 ─────┬──────> Phase 2 ────> Phase 3
             │                         │
             │                         v
             └──────────────────> Phase 4
                                       │
                                       v
                                  Phase 5 ────> Phase 6 ────> Phase 7
                                                                 │
                                                                 v
                                                            Phase 8
```

---

## リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| Yahoo Finance API制限 | データ取得失敗 | キャッシュ、代替API準備 |
| パフォーマンス問題 | UX低下 | Web Worker、最適化 |
| ブラウザ互換性 | 動作不良 | ポリフィル、テスト |
| 戦略ロジックバグ | 誤った結果 | ユニットテスト徹底 |

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2024-12-23 | 1.0 | 初版作成 |
