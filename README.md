# StrategyLab

システムトレード戦略のバックテスト・分析ツール

![Version](https://img.shields.io/badge/version-1.5.1-blue)
![Strategies](https://img.shields.io/badge/strategies-72-green)
![License](https://img.shields.io/badge/license-MIT-yellow)

## 概要

StrategyLabは、72種類のトレード戦略を自動でバックテストし、最適な戦略とパラメーターを発見するためのWebアプリケーションです。グリッドサーチ最適化、モンテカルロシミュレーション、ウォークフォワード検証、ポートフォリオ最適化による統計的検証機能を搭載。資金管理に必要な指標（期待値・Kelly基準・ATR・CAGR等）も自動計算。

## 機能

### 🎯 72種類のトレード戦略

| カテゴリ | 戦略数 | 例 |
|----------|--------|-----|
| トレンドフォロー | 13 | SMA/EMAクロス、MACD、一目均衡表、KAMA、平均足 |
| モメンタム | 11 | RSI、ストキャスティクス、RCI、TRIX、DEMA |
| ブレイクアウト | 10 | ボリンジャースクイーズ、ATRトレーリング、ギャップ |
| ミーンリバーサル | 5 | RSIダイバージェンス、Zスコア、エンベロープ |
| ボリューム | 7 | OBV、VWAP、MFI、CMF、出来高スパイク |
| パターン認識 | 5 | ゴールデンクロス、ダブルボトム |
| 複合 | 11 | タートルズ、フィボナッチ、季節性、週足ピボット |
| カレンダー | 10 | 曜日効果、固定保有期間、月初月末 |

### 📊 分析機能

- **バックテストエンジン**: 過去データでの戦略検証
- **基本指標**: 勝率、プロフィットファクター、最大DD、シャープレシオ
- **資金管理指標**: 期待値、ペイオフレシオ、Kelly基準、CAGR、カルマーレシオ
- **複数銘柄比較**: 銘柄間での戦略パフォーマンス比較
- **パラメーター調整**: リアルタイムプレビュー付きスライダー
- **プリセット保存**: お気に入りの設定を保存

### 🔍 最適化機能

#### グリッドサーチ最適化（v1.2.0）
- パラメーター範囲指定（min/max/step）
- 目標関数選択（勝率/総リターン/PF/シャープレシオ）
- 最大5,000組み合わせ自動検証
- 最適パラメーター自動検出
- トップ100結果のスコア分布チャート

#### モンテカルロシミュレーション（v1.2.0）
- トレード順序シャッフル方式
- ブートストラップ（復元抽出）方式
- リターン分布（5%/25%/50%/75%/95%タイル）
- リスク指標（VaR、CVaR、損失確率、破産確率）
- サンプル資産曲線可視化
- 100〜10,000回シミュレーション対応

#### ウォークフォワード検証（v1.4.0 NEW）
- ローリングウィンドウ・アンカード方式
- 訓練/検証期間の自動分割（2〜10ウィンドウ）
- 過学習リスク評価（低/中/高）
- 堅牢性スコア・一貫性計算
- 訓練 vs 検証パフォーマンス比較
- 推奨事項の自動生成

#### ポートフォリオ最適化（v1.4.0）
- 5つの最適化手法：
  - 均等配分（Equal Weight）
  - リスクパリティ（Risk Parity）
  - 最大シャープレシオ（Max Sharpe）
  - 最小分散（Min Variance）
  - 最大リターン（Max Return）
- 相関行列・効率的フロンティア
- ウェイト配分チャート
- 分散比率・リスク指標

#### 資金管理指標（v1.5.0 NEW）

| 指標 | 説明 | 用途 |
|------|------|------|
| 期待値 | 1トレードあたりの期待利益% | 正の期待値戦略のみ採用 |
| ペイオフレシオ | 平均利益÷平均損失 | リスク/リワード評価 |
| リカバリーファクター | リターン÷最大DD | 回復力の評価 |
| Kelly基準 | 最適ポジションサイズ% | サイズ決定の基準 |
| 日次ボラティリティ | 日次リターンの標準偏差 | リスク管理 |
| 平均ATR% | 終値に対するATR | ロットサイズ調整 |
| CAGR | 年率換算リターン | 年間パフォーマンス |
| カルマーレシオ | CAGR÷最大DD | リスク調整後リターン |

**使い方の例:**
1. 最大DDで許容リスクを決めてサイズ上限を設定
2. 期待値が正の戦略のみ採用
3. ATR×係数で許容損失を固定しロット調整
4. 最大連敗数で縮小ルール作成（例: 連敗3で半分）

### 📈 可視化

- **価格チャート**: ローソク足/ラインチャート（lightweight-charts）
- **売買シグナル**: チャート上にEntry/Exitマーカー表示（※ロングのみ対応）
- **結果チャート**: 戦略別パフォーマンス比較グラフ
- **最適化チャート**: スコア分布、サンプル資産曲線、効率的フロンティア

### 📖 ユーザーマニュアル（v1.5.1 NEW）

- **使い方ヘルプ**: スライドパネル形式でアプリ内で表示（ヘッダーの「?」ボタン）
- **戦略ガイド**: 72戦略の詳細解説ページ（/docs）
  - カテゴリー別表示
  - 検索・フィルター機能
  - パラメーター一覧

### 📤 エクスポート

- **データ出力**: CSV / JSON
- **コード生成**: PineScript (TradingView) / MQL4 / MQL5

## 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript 5.1+
- **UI**: shadcn/ui, Tailwind CSS
- **チャート**: Recharts, lightweight-charts
- **データソース**: Yahoo Finance API

## セットアップ

```bash
# リポジトリをクローン
git clone https://github.com/yourname/strategy-lab.git
cd strategy-lab

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

ブラウザで http://localhost:3000 を開きます。

## 使い方

### 基本的な使い方

1. **ティッカー入力**: 分析したい銘柄コードを入力（例: AAPL, NVDA, 7203.T）
2. **期間選択**: バックテスト期間を選択（3ヶ月〜10年）
3. **分析開始**: ボタンをクリックして72戦略のバックテストを実行
4. **結果確認**: 
   - 結果一覧タブで戦略別パフォーマンスを確認
   - 銘柄比較タブで複数銘柄の比較分析
   - チャートタブで価格と売買シグナルを可視化
5. **パラメーター調整**: パラメータータブでスライダーを調整
6. **エクスポート**: 結果をCSV/JSON/コードとして出力

### 最適化機能の使い方

1. **戦略を選択**: 結果一覧から最適化したい戦略をクリック
2. **最適化タブを開く**: グリッドサーチ/モンテカルロ/WF検証/ポートフォリオを選択
3. **グリッドサーチ**: 
   - パラメーター範囲を設定
   - 目標関数を選択
   - 実行して最適パラメーターを発見
4. **モンテカルロ**: 
   - シミュレーション回数を選択
   - 実行して統計的リスク指標を確認
5. **ウォークフォワード検証**:
   - ウィンドウ数と訓練比率を設定
   - 実行して過学習リスクを評価
6. **ポートフォリオ最適化**:
   - 複数の戦略/銘柄を選択
   - 最適化手法を選択
   - 実行して最適ウェイトを計算

## 対応銘柄

- 米国株: AAPL, GOOGL, MSFT, NVDA, TSLA など
- 日本株: 7203.T (トヨタ), 9984.T (ソフトバンク) など
- ETF: SPY, QQQ, VTI など
- 指数: ^GSPC (S&P 500), ^N225 (日経225)

## プロジェクト構成

```
strategy-lab/
├── src/
│   ├── app/                 # Next.js App Router
│   │   ├── api/            # APIエンドポイント
│   │   │   ├── backtest/   # バックテストAPI
│   │   │   ├── export/     # エクスポートAPI
│   │   │   ├── optimize/   # 最適化API
│   │   │   │   ├── grid-search/    # グリッドサーチ
│   │   │   │   ├── monte-carlo/    # モンテカルロ
│   │   │   │   ├── walk-forward/   # ウォークフォワード
│   │   │   │   └── portfolio/      # ポートフォリオ
│   │   │   └── stock/      # 株価取得API
│   │   └── page.tsx        # メインページ
│   ├── components/         # UIコンポーネント
│   ├── lib/
│   │   ├── backtest/       # バックテストエンジン
│   │   ├── indicators/     # テクニカル指標
│   │   ├── optimization/   # 最適化ロジック
│   │   │   ├── grid-search.ts
│   │   │   ├── monte-carlo.ts
│   │   │   ├── walk-forward.ts
│   │   │   └── portfolio.ts
│   │   └── strategies/     # トレード戦略
│   └── types/              # TypeScript型定義
├── docs/                   # ドキュメント
└── public/                 # 静的ファイル
```

## 戦略一覧

<details>
<summary>全72戦略を表示</summary>

### トレンドフォロー (TF001-TF013)
- TF001: SMAクロスオーバー
- TF002: EMAクロスオーバー
- TF003: MACDシグナル
- TF004: ADXトレンド
- TF005: パラボリックSAR
- TF006: スーパートレンド
- TF007: 一目均衡表・雲ブレイク
- TF008: DMI（方向性指数）
- TF009: KAMA（適応型MA）
- TF010: 平均足
- TF011: トリプルMA
- TF012: アルーン
- TF013: チョピネス指数

### モメンタム (MO001-MO011)
- MO001: RSI順張り
- MO002: RSI逆張り
- MO003: ストキャスティクス
- MO004: CCI
- MO005: ウィリアムズ%R
- MO006: ROC（変化率）
- MO007: モメンタム
- MO008: RCI（順位相関指数）
- MO009: TRIX
- MO010: DEMAクロス
- MO011: フォースインデックス

### ブレイクアウト (BO001-BO010)
- BO001: ボリンジャーバンド・ブレイクアウト
- BO002: ドンチャンチャネル
- BO003: ケルトナーチャネル
- BO004: 52週高値ブレイク
- BO005: ATRブレイクアウト
- BO006: ボリンジャースクイーズ
- BO007: ATRトレーリングストップ
- BO008: シャンデリアエグジット
- BO009: ギャップ戦略
- BO010: ボラティリティブレイクアウト

### ミーンリバーサル (MR001-MR005)
- MR001: ボリンジャーバンド逆張り
- MR002: RSIダイバージェンス
- MR003: 移動平均乖離率
- MR004: Zスコア
- MR005: エンベロープ

### ボリューム (VO001-VO007)
- VO001: OBV
- VO002: VWAPリバーサル
- VO003: ボリュームブレイクアウト
- VO004: MFI
- VO005: CMF（チャイキンマネーフロー）
- VO006: 出来高スパイク
- VO007: VWMA（出来高加重MA）

### パターン認識 (PA001-PA005)
- PA001: ゴールデンクロス
- PA002: デッドクロス
- PA003: 三役好転
- PA004: ダブルボトム
- PA005: ヘッドアンドショルダー

### 複合 (CO001-CO011)
- CO001: MACD+RSIフィルター
- CO002: トレンド+モメンタム
- CO003: ボラティリティ調整
- CO004: 移動平均リボン
- CO005: 高値安値チャネル
- CO006: ピボットポイント
- CO007: フィボナッチ
- CO008: ハイローブレイクアウト
- CO009: タートルズ
- CO010: 季節性戦略
- CO011: 週足ピボット

### カレンダー (CA001-CA005, FH001-FH005)
- CA001: 月曜買い・金曜売り
- CA002: 金曜買い・月曜売り
- CA003: 火曜買い・木曜売り
- CA004: 月初買い・月末売り
- CA005: 月末買い・月初売り
- FH001: 1日保有
- FH002: 3日保有
- FH003: 5日保有
- FH004: 10日保有
- FH005: 20日保有

</details>

## 更新履歴

- **v1.5.1** - ユーザーマニュアル追加、UI改善、yahoo-finance2 v3対応 🆕
- **v1.5.0** - 資金管理指標追加（期待値・Kelly・ATR・CAGR・Calmar等）
- **v1.4.0** - ウォークフォワード検証・ポートフォリオ最適化追加
- **v1.3.0** - カレンダー戦略追加（曜日効果・固定保有・月初月末）72戦略
- **v1.2.0** - グリッドサーチ最適化、モンテカルロシミュレーション追加
- **v1.1.0** - 20戦略追加（計62戦略）、拡張指標13種追加
- **v1.0.0** - 初回リリース（42戦略）

## ライセンス

MIT

## 免責事項

本ツールは教育・研究目的で提供されています。実際の投資判断は自己責任で行ってください。過去のパフォーマンスは将来の結果を保証するものではありません。
